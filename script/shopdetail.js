"use strict";var _createClass=function(){function o(t,i){for(var s=0;s<i.length;s++){var o=i[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,i,s){return i&&o(t.prototype,i),s&&o(t,s),t}}();function _toConsumableArray(t){if(Array.isArray(t)){for(var i=0,s=Array(t.length);i<t.length;i++)s[i]=t[i];return s}return Array.from(t)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}define(["jquery","top","jquerycookie"],function(a,t){return{init:function(){function i(){var t;_classCallCheck(this,i),this.topBn=a(".bn .bn-left").find("em"),this.bottomBn=a(".bn .bn-right").find("em"),this.detailRightImgWrap=a(".instruduce"),this.detailRightImgBox=a(".instruduce .imgwrap"),this.detailRightIndex=0,this.detailRightImgArr=["https://img-tmdetail.alicdn.com/bao/uploaded///img.alicdn.com/bao/uploaded/O1CN0103BaHd1Dz1phM0ka8_!!0-item_pic.jpg_160x160q90.jpg","https://img.alicdn.com/bao/uploaded/i1/619123122/O1CN01q5tLj11Yvv8FeohTP_!!2-item_pic.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/bao/upload/TB1GSICVXzqK1RjSZFvXXcB7VXa.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/bao/upload/TB1k4cgH4v1gK0jSZFFXXb0sXXa.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/bao/upload/TB1n5j4HHr1gK0jSZR0XXbP8XXa.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/i2/2973966816/O1CN01NYauwy20DmBsJzRM5_!!2973966816.jpg_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/bao/upload/TB1Eozns7T2gK0jSZPcXXcKkpXa.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/bao/upload/TB1RATNcrj1gK0jSZFOXXc7GpXa.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/bao/upload/TB1qVQxcQ9l0K4jSZFKXXXFjpXa.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/bao/upload/TB18Q.bkoT1gK0jSZFrXXcNCXXa.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/bao/upload/TB16FQUc4D1gK0jSZFKXXcJrVXa.png_400x400q60.jpg","https://img.alicdn.com/bao/uploaded/i3/3409867774/O1CN01BbDugK27IXd1MwqUe_!!3409867774.jpg_400x400q60.jpg"],(t=this.detailRightImgArr).push.apply(t,_toConsumableArray(this.detailRightImgArr.slice(0,3))),this.detailRightNum=Math.ceil(this.detailRightImgArr.length/3)-1,this.shopNum=1,this.shopNumInput=a(".shopnum").find("input"),this.shopNumAdd=a(".shopnum").find(".num-top em"),this.shopNumCut=a(".shopnum").find(".num-bottom em"),this.mirror=a(".small-box").find(".mirror"),this.smallBox=a(".small-box"),this.bigBox=a(".big-box"),this.scrollImgList=a(".scrollImg"),this.title=a(".detail-center").find(".title"),this.detail=a(".detail-center").find(".detail"),this.price=a(".detail-center").find(".price b"),this.weight=a(".detail-center").find(".weight b"),this.comment=a(".detail-center").find(".comment span"),this.score=a(".detail-center").find(".getscore span"),this.person=a(".person-left").find("em"),this.renderPage(),this.bigPic=a(".big-pic"),this.smallpic=a(".small-pic"),this.addCar=a(".detail-center").find(".addcar"),this.detailInit()}t.topinit(),new(_createClass(i,[{key:"detailInit",value:function(){var i=this;this.detailRightScroll(),this.shopNumInput.val(this.shopNum),this.shopNumInput.on("blur",function(t){return i.shopNumInputHandler(t)}),this.shopNumAdd.on("click",function(t){return i.shopNumClickHandler(t)}),this.shopNumCut.on("click",function(t){return i.shopNumClickHandler(t)}),this.smallpic.css({width:this.smallBox[0].offsetWidth*(this.bigBox[0].offsetWidth/this.bigPic[0].offsetWidth),height:this.smallBox[0].offsetHeight*(this.bigBox[0].offsetHeight/this.bigPic[0].offsetHeight)}),this.smallBox.on("mouseover mouseout mousemove",function(t){return i.smallBoxHandler(t)}),this.addCar.on("click",function(t){return i.addCarHandler(t)})}},{key:"detailRightScroll",value:function(){var s=this;this.detailRightImgArr.forEach(function(t){var i=a("<img>");i.attr("src",t),s.detailRightImgBox.append(i)}),this.detailRightImgBox.css({height:this.detailRightImgWrap[0].offsetHeight*(this.detailRightNum+1)}),this.topBn.on("click",function(t){return s.detailRightclick(t)}),this.bottomBn.on("click",function(t){return s.detailRightclick(t)})}},{key:"detailRightclick",value:function(t){t.target===this.topBn[0]?0===this.detailRightIndex?(this.detailRightIndex=this.detailRightNum-1,this.detailRightImgBox.css({top:-this.detailRightNum*this.detailRightImgWrap[0].offsetHeight})):this.detailRightIndex--:this.detailRightIndex===this.detailRightNum?(this.detailRightIndex=1,this.detailRightImgBox.css({top:0})):this.detailRightIndex++,this.detailRightImgBox.stop(!0).animate({top:-this.detailRightIndex*this.detailRightImgWrap[0].offsetHeight})}},{key:"shopNumInputHandler",value:function(){(Number(this.shopNumInput.val())<=1||""===this.shopNumInput.val())&&this.shopNumInput.val(1),this.shopNum=Number(this.shopNumInput.val())}},{key:"shopNumClickHandler",value:function(t){t.target===this.shopNumAdd[0]?this.shopNum++:this.shopNum<=1?this.shopNum=1:this.shopNum--,this.shopNumInput.val(this.shopNum)}},{key:"smallBoxHandler",value:function(t){var i,s;t.target!==this.mirror[0]&&("mouseover"===t.type?(this.mirror.css("display","none"),this.bigBox.css({opacity:1,"z-index":2}),this.smallpic.css("display","block")):"mouseout"===t.type?(this.mirror.css("display","block"),this.bigBox.css({opacity:0,"z-index":-1}),this.smallpic.css("display","none")):"mousemove"===t.type&&(i=t.pageX-this.smallBox.offset().left-this.smallpic[0].offsetWidth/2,s=t.pageY-this.smallBox.offset().top-this.smallpic[0].offsetHeight/2,i<=0&&(i=0),i>=this.smallBox[0].offsetWidth-this.smallpic[0].offsetWidth&&(i=this.smallBox[0].offsetWidth-this.smallpic[0].offsetWidth),s<=0&&(s=0),s>=this.smallBox[0].offsetHeight-this.smallpic[0].offsetHeight&&(s=this.smallBox[0].offsetHeight-this.smallpic[0].offsetHeight),this.smallpic.css({left:i,top:s}),this.bigPic.css({left:-i/(this.smallBox[0].offsetWidth-this.smallpic[0].offsetWidth)*(this.bigPic[0].offsetWidth-this.bigBox[0].offsetWidth),top:-s/(this.smallBox[0].offsetHeight-this.smallpic[0].offsetHeight)*(this.bigPic[0].offsetHeight-this.bigBox[0].offsetHeight)})))}},{key:"scrollImgHandler",value:function(t){this.smallBox.find("img").attr("src",t.target.src),this.bigPic.attr("src",t.target.src),a(t.target).css({outline:"3px solid #000"}).parent("li").siblings("li").find("img").css({outline:"none"})}},{key:"renderPage",value:function(){var e=this,t=location.search.slice(5);a.ajax({url:"http://localhost/tianmao/dist/php/detail.php",data:"sid="+t,type:"post"}).done(function(t){var i=JSON.parse(t),s=a("<img>");s.attr("src",i.pic),e.smallBox.append(s),e.bigPic.attr("src",i.pic);var o=i.piclist.split(",");o[0]=i.pic,o.forEach(function(t,i){var s=a("<li></li>"),o=a("<img>");0===i&&o.css({outline:"3px solid #000"}),o.attr("src",t),o.appendTo(s),s.appendTo(e.scrollImgList)}),e.scrollImg=a(".scrollImg li").find("img"),e.scrollImg.on("mouseover",function(t){return e.scrollImgHandler(t)}),e.title.html(i.title),e.detail.html(i.detail),e.price.html("<em>￥</em>"+i.price),e.weight.html(i.weight+"<em>kg</em>"),e.comment.html(i.comment),e.score.html(i.score),e.person.html("("+i.person+" 人气)")})}},{key:"addCarHandler",value:function(){a.cookie("shopid")&&a.cookie("shopnum")?(this.goodsNum=JSON.parse(a.cookie("shopnum")),this.goodsId=JSON.parse(a.cookie("shopid"))):(this.goodsNum=[],this.goodsId=[]);var t=this.goodsId.indexOf(location.search.slice(5));-1===t?(this.goodsId.push(location.search.slice(5)+""),this.goodsNum.push(this.shopNum)):this.goodsNum[t]=this.goodsNum[t]+this.shopNum,a.cookie("shopid",JSON.stringify(this.goodsId),{expires:7,path:"/"}),a.cookie("shopnum",JSON.stringify(this.goodsNum),{expires:7,path:"/"}),location.href="./car.html"}}]),i)}}});