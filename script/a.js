"use strict";var _createClass=function(){function a(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}define(["jquery","top","jquerycookie"],function(d,e){return{init:function(){function t(){_classCallCheck(this,t),this.shopid=d.cookie("shopid"),this.shopnum=d.cookie("shopnum"),this.allGoods=d(".cartop p").find("span"),this.tableList=d(".tableList"),this.judgeshop=[],this.totalPrice=d(".car-bottom-right").find(".total"),this.totalNum=d(".car-bottom-right").find("b span"),this.publicNum=0,this.allCheck=d(".table-top").find("input"),this.allBottomCheck=d(".car-bottom").find("input[type=checkbox]"),this.totalMoneyCopy=d(".cartop").find("b"),this.totalMoney=0,this.totalshopNum=0,this.focusNum=0,this.countSmall=d(".cartop").find("input"),this.count=d(".car-bottom").find(".bn"),this.initity()}e.topinit(),new(_createClass(t,[{key:"initity",value:function(){this.shopid&&this.shopnum&&(this.shopid=JSON.parse(this.shopid),this.shopnum=JSON.parse(this.shopnum),this.renderPage(this.shopid,this.shopnum),this.allShoopNum=this.shopid.length,this.allGoods.html(this.allShoopNum))}},{key:"renderPage",value:function(t,u){var m=this;d.ajax({url:"http://localhost/tianmao/dist/php/getsid.php",type:"post",data:"sid="+JSON.stringify(t)}).done(function(t){var e=JSON.parse(t),o=!0,a=!1,n=void 0;try{for(var l,r=e[Symbol.iterator]();!(o=(l=r.next()).done);o=!0){var i,p,c,s=l.value,h=u[e.indexOf(s)];-1===m.judgeshop.indexOf(s.store)?(m.judgeshop.push(s.store),i='<div class="table-center '+s.store+'">\n                                <div class="store"><input type="checkbox">店铺：<span>'+s.shopname+"</span><img src='./img/shoplist.png'></div>\n                                <table>\n                                    <tr sid="+s.id+'>\n                                        <td><input type="checkbox"></td>\n                                        <td><img src="'+s.pic+'" alt=""></td>\n                                        <td>'+s.title+"</td>\n                                        <td>"+s.detail+'</td>\n                                        <td>￥<span class="danjia">'+s.price+'</span></td>\n                                        <td><span class="left">-</span><input type="text" value='+h+" class='shuliang'><span class=\"right\">+</span></td>\n                                        <td>￥<span class='xiaoji'>"+h*s.price+"</span></td>\n                                        <td><span class='singledel'>删除</span></td>\n                                    </tr>\n                                </table>\n                            </div>",m.tableList[0].innerHTML+=i):(p=d(".tableList").find("."+s.store).find("table"),c="\n                                <tr style='border-top:1px solid gray;padding-top:1px' sid="+s.id+'>\n                                    <td><input type="checkbox"></td>\n                                    <td><img src="'+s.pic+'" alt=""></td>\n                                    <td>'+s.title+"</td>\n                                    <td>"+s.detail+'</td>\n                                    <td>￥<span class="danjia">'+s.price+'</span></td>\n                                    <td><span class="left">-</span><input type="text" value='+h+" class='shuliang'><span class=\"right\">+</span></td>\n                                    <td>￥<span class='xiaoji'>"+h*s.price+"</span></td>\n                                    <td><span class='singledel'>删除</span></td>\n                                </tr>\n                                ",p[0].innerHTML+=c)}}catch(t){a=!0,n=t}finally{try{!o&&r.return&&r.return()}finally{if(a)throw n}}m.lastfn()})}},{key:"lastfn",value:function(){var l=this;this.othercheck=d(".tableList").find("input[type=checkbox]"),this.otherchecksmall=d(".tableList").find("table").find("input[type=checkbox]"),this.othershopcheck=d(".table-center").find(".store").find("input"),this.allCheck.on("click",function(t){var o,a;l.otherchecksmall=d(".tableList").find("table").find("input[type=checkbox]"),l.othercheck.prop("checked",l.allCheck.prop("checked")),l.allBottomCheck.prop("checked",l.allCheck.prop("checked")),l.allCheck.prop("checked")?(a=o=0,l.otherchecksmall.parent().parent().find(".xiaoji").each(function(t,e){o+=Number(d(e).parent().parent().find(".shuliang").val()),a+=Number(d(e).html()),console.log(e)}),l.totalMoney=a,l.totalshopNum=o,l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney),l.count.css("backgroundColor","#f40"),l.countSmall.css("backgroundColor","#f40")):(l.totalMoney=0,l.totalshopNum=0,l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney),l.count.css("backgroundColor","gray"),l.countSmall.css("backgroundColor","gray"))}),this.allBottomCheck.on("click",function(t){var o,a;l.otherchecksmall=d(".tableList").find("table").find("input[type=checkbox]"),l.othercheck.prop("checked",l.allBottomCheck.prop("checked")),l.allCheck.prop("checked",l.allBottomCheck.prop("checked")),l.allBottomCheck.prop("checked")?(a=o=0,l.otherchecksmall.parent().parent().find(".xiaoji").each(function(t,e){o+=Number(d(e).parent().parent().find(".shuliang").val()),a+=Number(d(e).html())}),l.totalMoney=a,l.totalshopNum=o,l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney),l.count.css("backgroundColor","#f40"),l.countSmall.css("backgroundColor","#f40")):(l.totalMoney=0,l.totalshopNum=0,l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney),l.count.css("backgroundColor","gray"),l.countSmall.css("backgroundColor","gray"))}),this.othershopcheck.on("click",function(t){d(t.target).prop("checked")&&d(t.target).parent().next("table").find("tr").each(function(t,e){d(e).find("input[type=checkbox]").prop("checked")&&(l.totalshopNum-=Number(d(e).find(".shuliang").val()),l.totalMoney-=Number(d(e).find(".xiaoji").html()))}),d(t.target).parent().siblings("table").find("input[type=checkbox]").prop("checked",d(t.target).prop("checked"));var o=!0;Array.from(l.othershopcheck).forEach(function(t,e){!1===d(t).prop("checked")&&(o=!1)}),l.allCheck.prop("checked",o),l.allBottomCheck.prop("checked",o),d(t.target).parent().next("table").find("tr").each(function(t,e){d(e).find("input[type=checkbox]").prop("checked")?(l.totalshopNum+=Number(d(e).find(".shuliang").val()),l.totalMoney+=Number(d(e).find(".xiaoji").html())):(l.totalshopNum-=Number(d(e).find(".shuliang").val()),l.totalMoney-=Number(d(e).find(".xiaoji").html()))}),l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney);var a=!1;Array.from(l.otherchecksmall).forEach(function(t,e){d(t).prop("checked")&&(l.count.css("backgroundColor","#f40"),l.countSmall.css("backgroundColor","#f40"),a=!0)}),a||(l.count.css("backgroundColor","gray"),l.countSmall.css("backgroundColor","gray"))}),this.otherchecksmall.on("click",function(t){var e=d(t.target).parent().parent().parent().parent().siblings(".store"),o=!0,a=!0,n=!1;Array.from(e.siblings("table").find("input[type=checkbox]")).forEach(function(t,e){!1===d(t).prop("checked")&&(o=!1)}),e.find("input").prop("checked",o),Array.from(l.otherchecksmall).forEach(function(t,e){!1===d(t).prop("checked")&&(a=!1)}),l.allCheck.prop("checked",a),l.allBottomCheck.prop("checked",a),d(t.target).prop("checked")?(l.totalMoney+=Number(d(t.target).parent().parent().find(".xiaoji").html()),l.totalshopNum+=Number(d(t.target).parent().parent().find(".shuliang").val())):(l.totalMoney-=Number(d(t.target).parent().parent().find(".xiaoji").html()),l.totalshopNum-=Number(d(t.target).parent().parent().find(".shuliang").val())),l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney),Array.from(l.otherchecksmall).forEach(function(t,e){d(t).prop("checked")&&(l.count.css("backgroundColor","#f40"),l.countSmall.css("backgroundColor","#f40"),n=!0)}),n||(l.count.css("backgroundColor","gray"),l.countSmall.css("backgroundColor","gray"))}),this.leftBn=d(".table-center").find(".left"),this.rightBn=d(".table-center").find(".right"),this.inputList=d(".table-center").find("table").find("input[type=text]"),this.leftBn.on("click",function(t){var e=d(t.target).siblings("input"),o=Number(d(t.target).parent().prev().find("span").html());l.publicNum=Number(d(t.target).siblings("input").val()),d(t.target).parent().parent().find("input[type=checkbox]").prop("checked")&&1!==l.publicNum&&(l.totalMoney-=Number(d(t.target).parent().parent().find(".danjia").html()),--l.totalshopNum,l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney)),l.publicNum<=1?l.publicNum=1:l.publicNum--,e.val(l.publicNum),d(t.target).parent().next().find("span").html(o*l.publicNum);var a=d(t.target).parent().parent().attr("sid"),n=l.shopid.indexOf(a);l.shopnum[n]=l.publicNum,d.cookie("shopnum",JSON.stringify(l.shopnum),{expires:7,path:"/"})}),this.rightBn.on("click",function(t){var e=Number(d(t.target).parent().prev().find("span").html());l.publicNum=Number(d(t.target).siblings("input").val()),l.publicNum++,d(t.target).siblings("input").val(l.publicNum),d(t.target).parent().next().find("span").html(e*l.publicNum);var o=d(t.target).parent().parent().attr("sid"),a=l.shopid.indexOf(o);l.shopnum[a]=l.publicNum,d.cookie("shopnum",JSON.stringify(l.shopnum),{expires:7,path:"/"}),d(t.target).parent().parent().find("input[type=checkbox]").prop("checked")&&(l.totalMoney+=Number(d(t.target).parent().parent().find(".danjia").html()),l.totalshopNum+=1,l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney))}),this.inputList.on("blur",function(t){Number(d(t.target).val())<=1&&d(t.target).val(1);var e=Number(d(t.target).parent().prev().find("span").html());l.publicNum=d(t.target).val(),d(t.target).val(l.publicNum),d(t.target).parent().next().find("span").html(e*l.publicNum);var o=d(t.target).parent().parent().attr("sid"),a=l.shopid.indexOf(o);l.shopnum[a]=l.publicNum,d.cookie("shopnum",JSON.stringify(l.shopnum),{expires:7,path:"/"}),d(t.target).parent().parent().find("input[type=checkbox]").prop("checked")&&(l.totalshopNum+=Number(d(t.target).val())-l.focusNum,l.totalMoney+=(Number(d(t.target).val())-l.focusNum)*Number(d(t.target).parent().parent().find(".danjia").html()),l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney))}),this.inputList.on("focus",function(t){l.focusNum=Number(d(t.target).val())}),this.singleDel=d(".table-center").find(".singledel"),this.singleDel.on("click",function(t){var e=d(t.target).parent().parent().attr("sid"),o=l.shopid.indexOf(e);l.shopnum.splice(o,1),l.shopid.splice(o,1),d.cookie("shopnum",JSON.stringify(l.shopnum),{expires:7,path:"/"}),d.cookie("shopid",JSON.stringify(l.shopid),{expires:7,path:"/"});var a=d(t.target).parent().parent().parent().parent().parent();d(t.target).parent().parent().find("input[type=checkbox]").prop("checked")&&(l.totalMoney-=Number(d(t.target).parent().parent().find(".xiaoji").html()),l.totalshopNum-=Number(d(t.target).parent().parent().find(".shuliang").val())),l.allShoopNum--,l.allGoods.html(l.allShoopNum);var n=d(t.target).parent().parent().parent().parent().find("tr").length-1;d(t.target).parent().parent().remove(),0==n&&a.remove(),l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney)}),this.bottomDel=d(".car-bottom").find(".del"),this.bottomDel.on("click",function(t){l.otherchecksmall=d(".tableList").find("table").find("input[type=checkbox]"),l.otherchecksmall.each(function(t,e){var o,a;d(e).prop("checked")&&(d(e).parent().attr("sid"),l.shopnum.splice(t,1),l.shopid.splice(t,1),d.cookie("shopnum",JSON.stringify(l.shopnum),{expires:7,path:"/"}),d.cookie("shopid",JSON.stringify(l.shopid),{expires:7,path:"/"}),l.totalMoney-=Number(d(e).parent().parent().find(".xiaoji").html()),l.totalshopNum-=Number(d(e).parent().parent().find(".shuliang").val()),l.totalPrice.html(l.totalMoney),l.totalNum.html(l.totalshopNum),l.totalMoneyCopy.html(l.totalMoney),l.allShoopNum--,l.allGoods.html(l.allShoopNum),o=d(e).parent().parent().parent().parent().parent(),a=d(e).parent().parent().parent().parent().find("tr").length-1,d(e).parent().parent().remove(),0==a&&o.remove())})})}}]),t)}}});